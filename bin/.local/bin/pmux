#!/usr/bin/env bash

# unset TMUX
PROJECTS=$(echo "CoreDNS Blog" | tr " " "\n")
SELECTED=$(echo -e "$PROJECTS" | fzf)
SESSIONEXISTS=$(tmux list-sessions | grep $SELECTED)

# Only create tmux session if it doesn't already exist
if [ "$SESSIONEXISTS" = "" ]
then
    tmux new-session -d -s $SELECTED

    if [[ "$SELECTED" == "CoreDNS" ]]; then
        tmux rename-window -t $SELECTED:1 'Main'
        tmux send-keys -t 'Main' 'cd /home/marius/open-source/CoreDNS/coredns-tlsplus/' C-m 'clear' C-m 'vi' C-m
        tmux new-window -t $SELECTED:2 -n 'Test'
        tmux send-keys -t 'Test' 'cd /home/marius/open-source/CoreDNS/coredns-tlsplus/' C-m 'clear' C-m
        tmux new-window -t $SELECTED:3 -n "CoreDNS"
        tmux send-keys -t 'CoreDNS' 'cd /home/marius/open-source/CoreDNS/coredns/' C-m 'clear' C-m
        tmux new-window -t $SELECTED:4 -n "Pebble"
        tmux send-keys -t 'Pebble' 'cd /home/marius/open-source/CoreDNS/coredns-tlsplus/test/' C-m 'clear' C-m
        tmux new-window -t $SELECTED:5 -n "Shell"
        tmux send-keys -t 'Shell' 'cd /home/marius/' C-m 'clear' C-m
    fi

    if [[ "$SELECTED" == "Blog" ]]; then
        tmux rename-window -t $SELECTED:1 'Main'
        tmux new-window -t $SELECTED:2 -n 'Test'
    fi
fi

if [ "$TERM_PROGRAM" = tmux ]; then
    tmux switch -t $SELECTED:1
else
    tmux attach-session -t $SELECTED:1
fi

